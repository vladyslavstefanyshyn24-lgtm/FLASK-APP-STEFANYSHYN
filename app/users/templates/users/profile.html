{% extends 'base.html' %}

{% block head %}
{{ super() }}
<style>
    body, .card { transition: background-color 0.3s, color 0.3s; }

    html.light body { background-color: #f8f9fa; color: #212529; }
    html.light .card { background-color: #ffffff; }
    html.light .table { color: #212529; }

    html.dark body { background-color: #212529; color: #f8f9fa; }
    html.dark .card { background-color: #343a40; }
    html.dark .table { color: #f8f9fa; }
    html.dark .table-striped>tbody>tr:nth-of-type(odd)>* { 
        --bs-table-accent-bg: rgba(255,255,255,0.05); 
        color: #f8f9fa; 
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">

    <h1 class="mb-4">Привіт, {{ session.get('username', 'Гість') }}!</h1>

    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Налаштування теми</h5>
            <a href="{{ url_for('users.set_theme', theme='light') }}" class="btn btn-outline-secondary">Світла</a>
            <a href="{{ url_for('users.set_theme', theme='dark') }}" class="btn btn-outline-dark">Темна</a>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Додати кукі</h5>
            <form action="{{ url_for('users.add_cookie') }}" method="POST" class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Ключ</label>
                    <input type="text" name="key" class="form-control" required>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Значення</label>
                    <input type="text" name="value" class="form-control" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Термін (днів)</label>
                    <input type="number" name="expiry_days" class="form-control" min="0" placeholder="Порожньо = сесія">
                </div>
                <div class="col-md-1 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">+</button>
                </div>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="card-title mb-0">Поточні куки ({{ cookies|length }})</h5>
                <form action="{{ url_for('users.delete_all_cookies') }}" method="POST">
                    <button type="submit" class="btn btn-danger btn-sm">Видалити всі</button>
                </form>
            </div>

            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Ключ</th>
                            <th>Значення</th>
                            <th style="width: 120px;">Дія</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if cookies %}
                            {% for key, value in cookies.items() %}
                            <tr>
                                <td><code>{{ key }}</code></td>
                                <td style="word-break: break-all; max-width: 400px;">{{ value }}</td>
                                <td>
                                    <form action="{{ url_for('users.delete_cookie') }}" method="POST" class="d-inline">
                                        <input type="hidden" name="key" value="{{ key }}">
                                        <button type="submit" class="btn btn-sm btn-outline-danger"
                                                onclick="return confirm('Видалити куку «{{ key }}»?')">
                                            Видалити
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="3" class="text-center text-muted py-4">Куки не знайдено</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>
{% endblock %}